{
	"name": "Delete tblService Rows",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "a_tblService",
						"type": "DatasetReference"
					},
					"name": "tblServiceBeforeDel"
				},
				{
					"dataset": {
						"referenceName": "MIMScsv",
						"type": "DatasetReference"
					},
					"name": "MIMS"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "a_tblService",
						"type": "DatasetReference"
					},
					"name": "tblService"
				}
			],
			"transformations": [
				{
					"name": "AlterRow2"
				},
				{
					"name": "SchPickUpDatetoDate"
				},
				{
					"name": "SchPickUpDate"
				},
				{
					"name": "MinMaxSchPickUpDates"
				},
				{
					"name": "Exists1"
				}
			],
			"script": "parameters{\n\tMinSchPickUpDate as string (\"2021-10-30 00:00:00.000\"),\n\tMaxSchPickUpDate as string (\"2021-10-30 23:45:00.000\")\n}\nsource(output(\n\t\tCoopID as string,\n\t\tCoopName as string,\n\t\tProdID as double,\n\t\tProdName as string,\n\t\tManifestNum as string,\n\t\tLT_No as double,\n\t\tCustID as double,\n\t\tCustName as string,\n\t\tHaulerID as string,\n\t\tHaulerName as string,\n\t\tScaleHeavy as double,\n\t\tSchPickUpDate as timestamp,\n\t\tActualPickUpDate as timestamp,\n\t\tSchDeliveryDate as timestamp,\n\t\tActualDeliveryDate as timestamp,\n\t\tRouteNum as string,\n\t\tRejected as double,\n\t\tServiceID as integer,\n\t\tDatasource as string,\n\t\tUpdated as timestamp\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> tblServiceBeforeDel\nsource(output(\n\t\tCoopID as string,\n\t\tCoopName as string,\n\t\tProdID as string,\n\t\tProdName as string,\n\t\tManifestNum as string,\n\t\tLT_No as string,\n\t\tCustID as string,\n\t\tCustName as string,\n\t\tHaulerID as string,\n\t\tHaulerName as string,\n\t\tScaleHeavy as string,\n\t\tSchPickUpDate as string,\n\t\tActualPickUpDate as string,\n\t\tSchDeliveryDate as string,\n\t\tActualDeliveryDate as string,\n\t\tRouteNum as string,\n\t\tRejected as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: true,\n\twildcardPaths:['*.csv']) ~> MIMS\nExists1 alterRow(deleteIf(SchPickUpDate>=toTimestamp($MinSchPickUpDate,\"yyyy-MM-dd HH:mm:ss.SSS\")&&SchPickUpDate<=toTimestamp($MaxSchPickUpDate,\"yyyy-MM-dd HH:mm:ss.SSS\"))) ~> AlterRow2\nSchPickUpDate derive(SchPickUpDate = toTimestamp(SchPickUpDate,\"MM/dd/yyyy H:mm\")) ~> SchPickUpDatetoDate\nMIMS select(mapColumn(\n\t\tSchPickUpDate\n\t),\n\tskipDuplicateMapInputs: false,\n\tskipDuplicateMapOutputs: false) ~> SchPickUpDate\nSchPickUpDatetoDate aggregate(minSchPickUpDate = min(SchPickUpDate),\n\t\tmaxSchPickUpDate = max(SchPickUpDate)) ~> MinMaxSchPickUpDates\ntblServiceBeforeDel, MinMaxSchPickUpDates exists(SchPickUpDate>=minSchPickUpDate && SchPickUpDate<=maxSchPickUpDate,\n\tnegate:false,\n\tbroadcast: 'auto')~> Exists1\nAlterRow2 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tCoopID as string,\n\t\tCoopName as string,\n\t\tProdID as double,\n\t\tProdName as string,\n\t\tManifestNum as string,\n\t\tLT_No as double,\n\t\tCustID as double,\n\t\tCustName as string,\n\t\tHaulerID as string,\n\t\tHaulerName as string,\n\t\tScaleHeavy as double,\n\t\tSchPickUpDate as timestamp,\n\t\tActualPickUpDate as timestamp,\n\t\tSchDeliveryDate as timestamp,\n\t\tActualDeliveryDate as timestamp,\n\t\tRouteNum as string,\n\t\tRejected as double,\n\t\tServiceID as integer,\n\t\tDatasource as string,\n\t\tUpdated as timestamp\n\t),\n\tdeletable:true,\n\tinsertable:false,\n\tupdateable:false,\n\tupsertable:false,\n\tkeys:['ServiceID'],\n\tskipKeyWrites:true,\n\tformat: 'table',\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\terrorHandlingOption: 'stopOnFirstError',\n\tmapColumn(\n\t\tCoopID,\n\t\tCoopName,\n\t\tProdID,\n\t\tProdName,\n\t\tManifestNum,\n\t\tLT_No,\n\t\tCustID,\n\t\tCustName,\n\t\tHaulerID,\n\t\tHaulerName,\n\t\tScaleHeavy,\n\t\tSchPickUpDate,\n\t\tActualPickUpDate,\n\t\tSchDeliveryDate,\n\t\tActualDeliveryDate,\n\t\tRouteNum,\n\t\tRejected,\n\t\tServiceID,\n\t\tDatasource,\n\t\tUpdated\n\t)) ~> tblService"
		}
	}
}